<!-- views/documents/index.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>My Documents</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .doc-list { display: flex; flex-wrap: wrap; gap: 20px; }
    .doc-item { border: 1px solid #ddd; padding: 10px; width: 300px; }
    .doc-item h3 { margin: 0 0 10px; }
    .doc-preview { height: 150px; overflow: hidden; margin-bottom: 10px; }
    .doc-preview embed, .doc-preview img { width: 100%; height: 100%; }
    .actions { margin-top: 10px; }
    a.button { display: inline-block; padding: 6px 12px; background: #007bff; color: #fff; text-decoration: none; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>My Documents</h1>
  <% if (error) { %>
    <p style="color:red;"><%= error %></p>
  <% } %>

  <form action="/documents/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="document" required />
    <input type="text" name="title" placeholder="Title" required />
    <select name="document_type" required>
      <option value="ID Proof">ID Proof</option>
      <option value="Address Proof">Address Proof</option>
      <option value="Certificate">Certificate</option>
      <option value="Other">Other</option>
    </select>
    <button type="submit">Upload</button>
  </form>

  <h2>Uploaded Documents</h2>
  <div class="doc-list">
    <% documents.filter(d => d.owner_name === 'You').forEach(doc => { %>
      <div class="doc-item">
        <h3><%= doc.title %></h3>
        <div class="doc-preview">
          <% if (doc.file_path.endsWith('.pdf')) { %>
            <embed src="<%= doc.file_path %>" type="application/pdf" />
          <% } else if (['.jpg','.jpeg','.png'].some(ext => doc.file_path.toLowerCase().endsWith(ext))) { %>
            <img src="<%= doc.file_path %>" alt="<%= doc.title %>" />
          <% } else { %>
            <p>No preview available</p>
          <% } %>
        </div>
        <div class="actions">
          <a class="button" href="<%= doc.file_path %>" download>Download</a>
          <a class="button" href="/documents/share/<%= doc.id %>">Share</a>
        </div>
      </div>
    <% }) %>
  </div>

  <h2>Documents Shared With Me</h2>
  <div class="doc-list">
    <% documents.filter(d => d.owner_name && d.owner_name !== 'You').forEach(doc => { %>
      <div class="doc-item">
        <h3><%= doc.title %> <small>by <%= doc.owner_name %></small></h3>
        <div class="doc-preview">
          <% if (doc.file_path.endsWith('.pdf')) { %>
            <embed src="<%= doc.file_path %>" type="application/pdf" />
          <% } else if (['.jpg','.jpeg','.png'].some(ext => doc.file_path.toLowerCase().endsWith(ext))) { %>
            <img src="<%= doc.file_path %>" alt="<%= doc.title %>" />
          <% } else { %>
            <p>No preview available</p>
          <% } %>
        </div>
        <div class="actions">
          <a class="button" href="<%= doc.file_path %>" download>Download</a>
        </div>
      </div>
    <% }) %>
  </div>
</body>
</html>
